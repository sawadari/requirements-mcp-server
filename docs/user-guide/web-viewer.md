# Webビューアー - インタラクティブUI

requirements-mcp-serverには、ブラウザで使えるインタラクティブなWebビューアーが付属しています。

---

## 🚀 起動方法

### 基本起動

```bash
npm run view-server
```

ブラウザで **http://localhost:5002** にアクセス

### Watch mode（開発用）

ファイル変更を監視して自動再起動：

```bash
npm run view-server:watch
```

---

## ✨ 主な機能

### 1. ツリービュー

**左側パネル** - 要求の階層構造を表示

- **カテゴリ別グループ化**
  - ステークホルダ要求（STK-xxx）
  - システム要求（SYS-xxx）
  - システム機能要求（FUN-xxx）

- **階層表示**
  - 親要求
    - 子要求
      - 孫要求

- **インタラクション**
  - クリックで詳細表示
  - 展開/折りたたみ
  - ハイライト表示

---

### 2. Search & Filter（検索・フィルター）

**中央パネル** - 強力な検索とフィルター機能

#### リサイズ可能

- 上端をドラッグして表示領域を調整
- 自由にパネルサイズを変更

#### キーワード検索

```
検索ボックスに入力:
- 要求のタイトル
- 説明
- ID（REQ-xxx）
```

#### フィルター機能

| フィルター | 説明 | 例 |
|-----------|------|---|
| **ステータス** | 状態で絞り込み | draft, approved, in_progress |
| **優先度** | 重要度で絞り込み | critical, high, medium, low |
| **カテゴリ** | カテゴリで絞り込み | ステークホルダ要求、システム要求 |
| **作成者** | 作成者で絞り込み | 動的に生成される |
| **タグ** | タグで絞り込み | カンマ区切りで複数指定可能 |

#### ビュー選択

| ビュー | 説明 |
|--------|------|
| **リスト** | 検索結果を一覧表示 |
| **マトリックス: ステークホルダ→システム** | トレーサビリティマトリックス |
| **マトリックス: システム→機能** | トレーサビリティマトリックス |

---

### 3. マトリックスビュー

**要求間の依存関係を2次元で可視化**

```
        SYS-001  SYS-002  SYS-003
STK-001    ●        ●        -
STK-002    -        ●        ●
STK-003    ●        -        ●
```

#### 表示内容

- **行**: 上位要求（例: ステークホルダ要求）
- **列**: 下位要求（例: システム要求）
- **●マーク**: 依存関係がある箇所
- **-**: 依存関係なし

#### 使い方

1. ビューセレクターで「マトリックス」を選択
2. 行タイプと列タイプを指定
3. マトリックスが自動生成される

#### トレーサビリティ確認

- ステークホルダ要求 → システム要求
- システム要求 → 機能要求
- 機能要求 → テストケース（カスタム設定）

---

### 4. カスタムビュー設定

`view-config.json` を編集して独自のビューを追加

#### 例: カスタムマトリックスの追加

```json
{
  "views": [
    {
      "id": "custom-matrix-1",
      "name": "カスタムマトリックス",
      "type": "matrix",
      "description": "ステークホルダ要求とシステム機能要求の直接マトリックス",
      "rowType": "stakeholder",
      "colType": "functional",
      "rowName": "ステークホルダ要求",
      "colName": "システム機能要求"
    }
  ]
}
```

サーバーを再起動すると、「ビュー」ドロップダウンに表示されます。

#### カスタマイズ可能な項目

- `id` - ユニークなID
- `name` - 表示名
- `type` - ビュータイプ（list, matrix）
- `description` - 説明
- `rowType` / `colType` - マトリックスの軸
- `rowName` / `colName` - 軸の表示名

---

### 5. Claude アシスタント

**右側パネル** - AIチャットで要求管理をサポート

#### 機能

- 要求の追加・検索・更新
- 依存関係分析
- 影響範囲分析
- バリデーションチェック
- 自然言語での操作

#### 使用例

```
チャット入力例:

"高優先度の要求を検索してください"
→ search_requirements(priority=high) を実行

"REQ-123の影響範囲を分析してください"
→ analyze_impact(id=REQ-123) を実行

"ステータスがdraftの要求をすべて表示"
→ search_requirements(status=draft) を実行
```

#### 統合されたMCPツール

Claudeアシスタントは21個のMCPツールすべてにアクセス可能。

詳細は [MCPツールリファレンス](mcp-tools.md) を参照。

---

### 6. 自動更新

**リアルタイム同期**

- ファイルシステムの変更を自動検知
- 5秒間隔で自動リフレッシュ
- 常に最新の要求情報を表示

#### 動作

1. MCPツールで要求を追加・更新
2. `data/requirements.json` が更新される
3. Webビューアーが変更を検知
4. 自動的に画面が更新される

**プレビューを閉じる必要はありません！**

---

## 📱 画面構成

```
┌─────────────────────────────────────────────────────┐
│ 🌐 Requirements MCP Server - Web Viewer            │
├─────────────┬─────────────────────┬─────────────────┤
│             │                     │                 │
│  ツリー     │  検索・フィルター   │  詳細表示       │
│  ビュー     │  + ビュー選択       │  + Chatアシスト │
│             │                     │                 │
│  [STK-001]  │  ┌───────────────┐ │ ┌─────────────┐ │
│  [STK-002]  │  │Search:        │ │ │Title: ...   │ │
│  [STK-003]  │  │  [keyword]    │ │ │Description  │ │
│             │  ├───────────────┤ │ │             │ │
│  [SYS-001]  │  │Filters:       │ │ │Status: ...  │ │
│  [SYS-002]  │  │ Status: [v]   │ │ │Priority:... │ │
│  [SYS-003]  │  │ Priority: [v] │ │ └─────────────┘ │
│             │  └───────────────┘ │                 │
│             │                     │  [Chat Panel]   │
│   リサイズ↕ │   リサイズ↔        │                 │
└─────────────┴─────────────────────┴─────────────────┘
```

---

## 🎨 テーマ

### ダークテーマ

デフォルトでモダンなダークテーマを適用：

- 目に優しい配色
- 長時間作業に適した設計
- シンタックスハイライト対応

---

## 🔧 設定

### ポート変更

デフォルト: `5002`

変更方法: `src/view-server.ts` を編集

```typescript
const PORT = 5002; // ここを変更
```

---

### 自動更新間隔

デフォルト: 5秒

変更方法: `src/view-server.ts` を編集

```typescript
const REFRESH_INTERVAL = 5000; // ミリ秒
```

---

## 💡 使い方のヒント

### 1. 検索の効率化

**AND検索**: カンマで区切る
```
認証,JWT
```

**OR検索**: スペースで区切る
```
認証 JWT
```

### 2. フィルターの組み合わせ

複数のフィルターを組み合わせて絞り込み：

```
Status: draft
Priority: high
Category: セキュリティ
```

### 3. マトリックスビューの活用

トレーサビリティマトリックスで：
- 上位要求から下位要求への追跡
- 漏れの検出
- カバレッジ確認

### 4. Claudeアシスタントの活用

複雑な操作はClaudeに任せる：
```
"優先度がhighで未完了の要求を検索して、
それぞれの影響範囲を分析してください"
```

---

## 🐛 トラブルシューティング

### ポートが既に使用されている

**エラー**: `Error: listen EADDRINUSE: address already in use :::5002`

**解決策**:
```bash
# プロセスを確認
netstat -ano | findstr :5002

# プロセスを終了（WindowsのPID）
taskkill /F /PID <PID>

# または別のポートを使用
# src/view-server.ts でポート番号を変更
```

### 画面が更新されない

**原因**: 自動更新が無効化されている

**解決策**:
1. ブラウザをリロード（Ctrl+R / Cmd+R）
2. サーバーを再起動

### Claudeアシスタントが応答しない

**原因**: `ANTHROPIC_API_KEY` が設定されていない

**解決策**:
```bash
# .envファイルに追加
ANTHROPIC_API_KEY=sk-ant-xxxxx

# サーバーを再起動
npm run view-server
```

---

## 関連ドキュメント

- [MCPツールリファレンス](mcp-tools.md) - Claudeアシスタントが使えるツール
- [バリデーション機能](validation.md) - 品質チェック
- [プロジェクト管理](project-management.md) - 複数プロジェクトの管理

---

**最終更新**: 2025-11-06

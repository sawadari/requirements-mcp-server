# 🚀 Requirements Chat - 使い方ガイド

## ✨ 完成した機能

**「WebチャットでAIが自動的に要求ツリーを作成」**

ユーザーが「ステークホルダ要求を追加して」と入力するだけで、AIが：
1. ステークホルダ要求を自動生成
2. 関連するシステム要求を2-3件生成
3. 各システム要求に対する機能要求を2-4件生成
4. 依存関係を自動設定（refines）
5. 妥当性チェック実行
6. 完了レポート表示

## 📋 前提条件

### 1. 環境変数の設定

`.env`ファイルに以下を追加：

```env
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxx
```

**取得方法**:
1. https://console.anthropic.com/ にアクセス
2. API Keysセクションで新しいキーを作成
3. `.env`ファイルに貼り付け

### 2. 依存パッケージのインストール

```bash
cd requirements-mcp-server
npm install
npm run build
```

## 🎮 使い方

### ステップ1: サーバー起動

```bash
npm run view-server
```

以下のような出力が表示されます：

```
✅ AI Chat Assistant initialized
✅ Enhanced Chat Assistant (Orchestrator) initialized
🚀 View server running at http://localhost:3010
📊 Operation Logs: http://localhost:3010/operations
```

### ステップ2: ブラウザでアクセス

ブラウザで http://localhost:3010 を開きます。

### ステップ3: チャットで要求を追加

画面右下のチャットボタンをクリックして、以下のようなメッセージを入力：

## 💬 デモシナリオ

### シナリオ1: セキュリティ要求の追加

**入力**:
```
セキュリティに関するステークホルダ要求を追加して
```

**期待される動作**:
1. AIがセキュリティ関連の要求内容を生成
2. ステークホルダ要求（STK-XXX）を作成
3. システム要求（SYS-XXX, SYS-YYY）を作成
4. 機能要求（FUNC-XXX, FUNC-YYY, ...）を作成
5. 依存関係を自動設定
6. 妥当性チェック実行

**AIの応答例**:
```
## ✅ 完了しました！

**実行ステップ**: 8/8 成功
**処理時間**: 42.3秒

### 作成された要求 (7件)

**ステークホルダ要求**:
- **STK-004**: アクセス制御とセキュリティの強化

**システム要求**:
- **SYS-007**: 認証システムの実装
- **SYS-008**: 監査ログの記録

**機能要求**:
- **FUNC-015**: マルチファクタ認証
- **FUNC-016**: ロールベースアクセス制御
- **FUNC-017**: ログ保存期間の設定
- **FUNC-018**: 不正アクセス検知

### 妥当性チェック

- ✅ 合格: 7件

---

📊 詳細を確認: http://localhost:3010
```

### シナリオ2: パフォーマンス要求の追加

**入力**:
```
パフォーマンスに関する要求を作成
```

**期待される動作**:
- パフォーマンス関連の要求ツリーが自動生成
- レスポンスタイム、スループット、リソース使用量などの要求が含まれる

### シナリオ3: 既存要求の検証

**入力**:
```
すべての要求を検証して
```

**期待される動作**:
- 全要求の妥当性チェック実行
- エラーがあれば一覧表示
- 修正提案を提示

### シナリオ4: 要求の検索

**入力**:
```
「搬送」に関する要求を検索
```

**期待される動作**:
- キーワード「搬送」を含む要求を検索
- 一覧を表示

## 🔍 対応しているコマンド

### 1. 要求の追加

| 入力例 | 動作 |
|-------|------|
| ステークホルダ要求を追加して | 要求ツリー全体を自動生成 |
| セキュリティに関する要求を作成 | セキュリティカテゴリの要求ツリー |
| パフォーマンスの要求を追加 | パフォーマンスカテゴリの要求ツリー |

### 2. 妥当性チェック

| 入力例 | 動作 |
|-------|------|
| STK-001をチェック | 単一要求の妥当性チェック |
| すべての要求を検証 | 全要求の一括検証 |
| 検証して | 全要求の妥当性チェック |

### 3. 要求の検索

| 入力例 | 動作 |
|-------|------|
| 「搬送」を検索 | キーワード検索 |
| セキュリティに関する要求を探して | カテゴリ検索 |

### 4. 自動修正

| 入力例 | 動作 |
|-------|------|
| エラーを修正して | 検証エラーの自動修正 |
| 自動修正 | 全要求の自動修正 |

### 5. 統計情報

| 入力例 | 動作 |
|-------|------|
| 統計を表示 | 要求の統計サマリ |

## 🎯 AIの動作原理

### 1. 意図分析 (IntentAnalyzer)

ユーザーの入力から意図を判断：
- `add_tree`: 要求ツリー作成
- `validate`: 妥当性チェック
- `search`: 要求検索
- `fix`: 自動修正

### 2. 実行計画作成 (TaskPlanner)

意図に応じたステップを生成：
```
1. AI生成: ステークホルダ要求の内容を生成
2. MCP呼び出し: ステークホルダ要求を追加
3. AI生成: システム要求2-3件を生成
4. MCP呼び出し: システム要求を一括追加
5. AI生成: 機能要求を生成
6. MCP呼び出し: 機能要求を一括追加
7. 検証: 全要求の妥当性チェック
8. 確認: 完了レポート生成
```

### 3. ステップ実行 (StepExecutor)

各ステップを順次実行：
- **AI生成**: Claude 3.5 Sonnetで要求内容を生成
- **MCP呼び出し**: BatchToolsで一括追加
- **検証**: ValidationToolsで妥当性チェック
- **レポート**: 実行結果をMarkdown形式で整形

## 🐛 トラブルシューティング

### 問題1: "ANTHROPIC_API_KEY not set"

**原因**: API Keyが設定されていない

**解決策**:
1. `.env`ファイルを作成
2. `ANTHROPIC_API_KEY=sk-ant-...`を追加
3. サーバーを再起動

### 問題2: "Fallback to Basic Chat Assistant"

**原因**: Enhanced Chat Assistantが利用できない（API Key未設定）

**動作**: 基本的なチャット機能のみ使用（要求ツリー自動生成は不可）

**解決策**: API Keyを設定してサーバー再起動

### 問題3: タイムアウトエラー

**原因**: AI生成に時間がかかりすぎている

**解決策**:
- より簡潔なメッセージを入力
- ネットワーク接続を確認
- しばらく待ってから再試行

### 問題4: 生成された要求の品質が低い

**原因**: プロンプトが不明確

**解決策**:
- より具体的なメッセージを入力
- 例: 「セキュリティ」→「アクセス制御とデータ暗号化に関するセキュリティ要求」

## 📊 ログとデバッグ

### サーバーログの確認

サーバーコンソールに以下のようなログが出力されます：

```
[Chat] Using Enhanced Chat Assistant (Orchestrator)
[IntentAnalyzer] Detected intent: add_tree (confidence: 0.95)
[TaskPlanner] Created plan with 8 steps
[StepExecutor] Executing plan: ステークホルダ要求とその下位要求ツリーを作成
[StepExecutor] Step step1 completed in 2341ms
[StepExecutor] Step step2 completed in 156ms
...
```

### 操作ログの確認

http://localhost:3010/operations にアクセスして、全操作履歴を確認できます。

## 🎓 ベストプラクティス

### 1. 具体的なメッセージを入力

**良い例**:
- 「アクセス制御とデータ暗号化に関するセキュリティ要求を作成」
- 「リアルタイム処理のパフォーマンス要求を追加」

**悪い例**:
- 「要求を追加」（何の要求か不明確）
- 「システム」（意図が不明確）

### 2. カテゴリを明示

AIはカテゴリを認識して適切な要求を生成します：
- セキュリティ
- パフォーマンス
- ユーザビリティ
- 保守性
- 拡張性

### 3. 段階的に追加

大量の要求を一度に追加するのではなく、カテゴリごとに分けて追加。

## 📚 参考資料

- [REQUIREMENTS-CHAT-ARCHITECTURE.md](./docs/REQUIREMENTS-CHAT-ARCHITECTURE.md)
- [IMPLEMENTATION-GUIDE.md](./docs/IMPLEMENTATION-GUIDE.md)
- [ROADMAP.md](./ROADMAP.md)
- [NEXT-STEPS.md](./NEXT-STEPS.md)

## 🎉 成功例

実際に動作している例：

```
👤 ユーザー: データバックアップに関するステークホルダ要求を追加して

🤖 AI: [8ステップを実行...]

## ✅ 完了しました！

**実行ステップ**: 8/8 成功
**処理時間**: 38.7秒

### 作成された要求 (6件)

**ステークホルダ要求**:
- **STK-005**: データバックアップとリカバリの実装

**システム要求**:
- **SYS-009**: 自動バックアップシステムの実装
- **SYS-010**: リカバリ機能の実装

**機能要求**:
- **FUNC-019**: 増分バックアップ
- **FUNC-020**: バックアップスケジュール設定
- **FUNC-021**: リカバリポイントの管理

### 妥当性チェック
- ✅ 合格: 6件
```

---

**作成日**: 2025-10-24
**ステータス**: Ready to Use 🚀
